sqlplus/nolog
connect djohnson/LobosRhi1!@ODSPEU1.ams
set echo off
set feedback off
set colsep ';'
set sqlprompt ''
set headsep off
set serveroutput on size unlimited
set linesize 30000
set trimspool on
set pagesize 0
set heading on
set trimout on
set wrap off
set termout off
spo U:\aib_theoretical_dataset_dec_jan_17.txt
select 
extract(year from CAST(AB.TRANSACTION_PROCESSING_DATE AS DATE)) AS YEAR--Year
,extract(month from CAST(AB.TRANSACTION_PROCESSING_DATE AS DATE)) AS MONTH--Month
,AB.TRANSACTION_TYPE
,AB.TRADING_MERCHANT_NAME --trading merchants
,AB.CONTRACT_ID --contract id
,AB.ISSUER_COUNTRY --issuer country
,AB.CLEARING_COUNTRY_NAME AS "MERCHANT_COUNTRY" --merchant country
,AB.ISSUER_COUNTRY_VISA_EUR_REL
,AB.ISSUER_COUNTRY_MC_SEPA_REL
,AB.INTERCHANGE_RATE_DESCRIPTION -- ic description
,AB.CARD_BRAND --card brand
,AB.SECURITY_LEVEL --security level
,SUM(AB.TRANSACTION_FLOW_EUR) AS FLOW --flow
,SUM(AB.VOLUME) AS VOL --volume
,ABS(SUM(AB.SCHEME_FEE_EUR)) AS SF --SF
,AB.SF_RATE_AMOUNT --Rate Amount
,AB.PRODUCT_CODE--product code
,AB.TRANSACTION_CURRENCY--transaction currency
,AB.TRANSACTION_FUNDING_CURRENCY--transaction funding currency
,AB.SF_RATE_PERC 
,AB.SF_RATE_DESCRIPTION
,AB.CARD_TYPE_GROUP
,AB.CARD_TYPE
,CASE WHEN AB.SECURITY_LEVEL LIKE '%Channel%' THEN 'Nonsecure'
WHEN AB.SECURITY_LEVEL NOT LIKE '%Channel%' THEN 'Secure'
END AS "Security Level" --security level
,AB.INTERCHANGE_REGION
,CASE WHEN AB.SF_RATE_DESCRIPTION LIKE '%Intra%' THEN 'Intra-Region'
WHEN AB.SF_RATE_DESCRIPTION LIKE '%Domestic%' THEN 'Domestic'
WHEN AB.SF_RATE_DESCRIPTION LIKE '%Inter%' THEN 'Inter-Region'
END AS "Regionality" --regionality
,CASE WHEN AB.CARD_BRAND LIKE '%Visa%' THEN 'Visa'
WHEN AB.CARD_BRAND LIKE '%Maestro%' THEN 'Maestro'
WHEN AB.CARD_BRAND LIKE '%MasterCard%' THEN 'MasterCard'
END AS "BRAND" --brand
,CASE WHEN AB.CARD_TYPE_GROUP LIKE '%Credit%' THEN ''
WHEN AB.CARD_TYPE_GROUP LIKE '%Debit%' THEN 'Debit'
WHEN AB.CARD_TYPE_GROUP LIKE '%Prepaid%' THEN 'Debit'
WHEN AB.CARD_TYPE_GROUP ='Commercial' THEN ''
END AS "CARD_TYPES" --card types
from FDWO.ACQUIRER_AIB_NEWGEN_FILES ab
where AB.PROCESSING_STATUS not in ('Suspended')
and AB.TRANSACTION_TYPE in ('Refund','Sale')
and AB.TRANSACTION_PROCESSING_DATE Between to_date('1/1/2018','MM/DD/YYYY') and to_date('12/31/2018','MM/DD/YYYY')
--and AB.ISSUER_REGION='EUROPE'
group by AB.TRANSACTION_TYPE,AB.TRADING_MERCHANT_NAME,AB.CONTRACT_ID,AB.ISSUER_COUNTRY,AB.CLEARING_COUNTRY_NAME,AB.CARD_BRAND,AB.SECURITY_LEVEL,AB.SF_RATE_AMOUNT
,AB.SF_RATE_PERC,AB.SF_RATE_DESCRIPTION,AB.CARD_TYPE_GROUP,AB.CARD_TYPE,AB.ISSUER_COUNTRY_VISA_EUR_REL,AB.ISSUER_COUNTRY_MC_SEPA_REL,AB.INTERCHANGE_RATE_DESCRIPTION,
AB.TRADING_MERCHANT_NAME,AB.CONTRACT_ID,AB.PRODUCT_CODE,AB.TRANSACTION_CURRENCY,AB.TRANSACTION_FUNDING_CURRENCY,extract(year from CAST(AB.TRANSACTION_PROCESSING_DATE AS DATE))
,AB.INTERCHANGE_REGION
,extract(month from CAST(AB.TRANSACTION_PROCESSING_DATE AS DATE));
spo end